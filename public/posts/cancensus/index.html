<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Work with Canadian Census data | Anqi Ma</title>
<meta name="keywords" content="RStudio">
<meta name="description" content="This is a course assignment demo (GG606 Scientific Data Wrangling)
  cancensus is a R package that can assess Statistics Canada Census data for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.
 1. Installation and retrieve the data vectors list (API key required) install.">
<meta name="author" content="Anqi Ma">
<link rel="canonical" href="http://maanqi4.github.io/posts/cancensus/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4011e96cb50c0badbd5e58bc6d1415a2f58babd783714a3a042388142298609f.css" integrity="sha256-QBHpbLUMC629Xli8bRQVovWLq9eDcUo6BCOIFCKYYJ8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://maanqi4.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://maanqi4.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://maanqi4.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://maanqi4.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://maanqi4.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://maanqi4.github.io/posts/cancensus/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Work with Canadian Census data" />
<meta property="og:description" content="This is a course assignment demo (GG606 Scientific Data Wrangling)
  cancensus is a R package that can assess Statistics Canada Census data for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.
 1. Installation and retrieve the data vectors list (API key required) install." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://maanqi4.github.io/posts/cancensus/" /><meta property="og:image" content="http://maanqi4.github.io/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-03-15T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://maanqi4.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="Work with Canadian Census data"/>
<meta name="twitter:description" content="This is a course assignment demo (GG606 Scientific Data Wrangling)
  cancensus is a R package that can assess Statistics Canada Census data for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.
 1. Installation and retrieve the data vectors list (API key required) install."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://maanqi4.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Work with Canadian Census data",
      "item": "http://maanqi4.github.io/posts/cancensus/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Work with Canadian Census data",
  "name": "Work with Canadian Census data",
  "description": "This is a course assignment demo (GG606 Scientific Data Wrangling)\n  cancensus is a R package that can assess Statistics Canada Census data for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.\n 1. Installation and retrieve the data vectors list (API key required) install.",
  "keywords": [
    "RStudio"
  ],
  "articleBody": " This is a course assignment demo (GG606 Scientific Data Wrangling)\n  cancensus is a R package that can assess Statistics Canada Census data for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.\n 1. Installation and retrieve the data vectors list (API key required) install.packages(\"cancensus\") library(cancensus) #view avaliable Census data list_census_datasets() #view regions and vectors in a given dataset list_census_regions(\"CA21\") list_census_vectors(\"CA21\") #retrieve the data needed #Warning: Cached regions list may be out of date. Set `use_cache = FALSE` to update it. library(geojsonsf) dataset  \"CA21\" #set census api set_cancensus_api_key('ENTER API KEY') set_cancensus_cache_path(here(\"data\")) library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ── ## ✔ ggplot2 3.4.0 ✔ purrr 1.0.0 ## ✔ tibble 3.1.8 ✔ dplyr 1.0.10 ## ✔ tidyr 1.2.1 ✔ stringr 1.5.0 ## ✔ readr 2.1.3 ✔ forcats 0.5.2 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag()  regions.list  list_census_regions(dataset, use_cache = FALSE) %% filter(level == \"PR\", name == \"Alberta\") %% as_census_region_list vec  find_census_vectors(\"housing\", dataset = dataset, query_type = \"semantic\") 2. Housing situation in Alberta 2.1 Dwelling Value # getting 2021 data # selecting vectors in need # Median Dwelling value dwelling.21.cost  get_census(dataset = \"CA21\", regions = regions.list, vectors = c(\"median.dwelling\"=\"v_CA21_4311\"), level = \"CSD\", labels = 'short', geo_format = 'sf') dwelling.21.value  get_census(dataset = \"CA21\", regions = regions.list, vectors = c(\"median.dwelling\"=\"v_CA21_4311\"), level = \"CSD\", labels = 'short') %% slice_max(median.dwelling, prop = .05) ggplot(dwelling.21.cost) + geom_sf(aes(fill=median.dwelling)) + theme_minimal() + theme(panel.grid = element_blank(), axis.text = element_blank(), axis.ticks = element_blank(), strip.text.x = element_text(size=12)) + coord_sf(datum=NA) + scale_fill_viridis_c(\"Median Dwellings Value\", labels = scales::dollar) By looking at general housing situation, I first started with the price of dwellings. The first figure showed the distribution of median dwelling value in Alberta. In a large number of district, the value of dwellings are around $500,000 and above. Roughly, the price of dwellings is more expensive in the southern Alberta compared with the North, which might related to what kind of climate people want to live in. There is a special pattern around the district of Calgary, where in the center of Calgary, the price of dwellings is far less than its surrounding area. The similar, but less obvious pattern could be found around Edmonton. The reason may relate to people prefer to live in suburban area compared with living in downtown, but the gap of dwellings value around Calgary is astonishing. Besides, the surrounding cycle outside Alberta is the most expensive area in terms of dwellings value in the province. The next figure will look into it in more detail.\noptions(scipen = 999) ggplot(dwelling.21.value, aes(x=median.dwelling, y=fct_reorder(`Region Name`, median.dwelling))) + geom_point() + theme_minimal() + theme(axis.title.y = element_blank()) + xlab(\"Median Dwellings Value\") + ggtitle(\"Districts with Top 5% Median Dwellings Value in Alberta\") The second figure looked into dwelling value in more detail: showing the districts with top 5% median dwelling value. 25 out of 423 districts in Alberta have been selected with higher median dwelling value, and particularly, all district with median dwelling value higher than $500,000 have been selected. Apparently, the district around Calgary have all been included, and also the districts to the west of Calgary. By Google-search these district names, I realized these districts located in a good place for relax and vacation. There are often beside the lake (e.g. Birchcliff, Jarvis Bay) or near natural park (e.g. Banff, Jasper). The abnormal increase of the dwelling value may be related to its good location and nature environment.\n2.2 Monthly cost # Median Monthly shelter cost mon.cost.21  get_census(dataset = \"CA21\", regions = regions.list, vectors = c(\"median.cost.rent\"=\"v_CA21_4317\", \"median.cost.own\"=\"v_CA21_4309\"), level = \"CSD\", geo_format = 'sf', labels = 'short') mon.cost.21  mon.cost.21 %% pivot_longer(cols = starts_with(\"median.cost\"), names_to = \"status\", names_prefix = \"median.cost.\", values_to = \"month.cost\") mon.cost.21$status  factor(mon.cost.21$status, levels = c(\"own\",\"rent\"), labels = c(\"Owner Households\", \"Renter Households\")) ggplot(mon.cost.21) + geom_sf(aes(fill=month.cost)) + theme_minimal() + theme(panel.grid = element_blank(), axis.text = element_blank(), axis.ticks = element_blank(), strip.text.x = element_text(size=12)) + coord_sf(datum=NA) + scale_fill_viridis_c(\"Median Monthly cost\", labels = scales::dollar) + facet_wrap(~status) The next question I had about the housing is whether the cost of housing people spend monthly share the same distribution as the dwelling price?\nThe above figure showed the median monthly cost people spend per household. The monthly cost, in general, share the same characteristic as the dwelling price: where the dwelling value is low, the monthly cost people spend on housing is also tend to be low.\nThere are 2 interesting differences: first the cycle of higher price around Calgary is disappeared. So people who live in high value dwellings actually don’t spend significantly more monthly. It might because those high value dwellings are owned, not rented, and the cost for owner maintaining is not significantly higher. We can also notice this in the right sub-figure in figure-3, where area which has high value of dwellings actually have average or even lower monthly cost for renter households.\nThe second interesting difference is between the owner household and renter household. The monthly cost distribution tend to be the same, however, in the northeastern area, the owner households have a abnormal high cost monthly. By Google-search, the Northeastern area is agricultural area, where the owner might spend more to maintain their farm house, which not only serve as living.\n2.3 Difference between large cities and elsewhere # Number of Household of Renter and Owner household  get_census(dataset = \"CA21\", regions = regions.list, vectors = c(\"status.Renter\"=\"v_CA21_4239\", \"status.Owner\"=\"v_CA21_4238\", \"total.house\"=\"v_CA21_4237\"), level = \"CSD\", labels = 'short') household  household %% slice_max(total.house, n=5) ggplot(household, aes(x=total.house, y=fct_reorder(`Region Name`, total.house))) + geom_col(fill=\"cornflowerblue\") + theme_minimal() + theme(axis.title.y = element_blank()) + xlab(\"Number of Households\") + ggtitle(\"Districts with Top 5 Number of Household in Alberta\") While I looking at the household distribution, I realized the households are distributed very unevenly within Alberta. The above figure showed the districts with top 5 number of household in Alberta. As shown in the figure, the number of household in Calgary and Edmonton is extremely larger than the rest of the province. Calgary has around 500,000 households, with about 400,000 in Edmonton, while the third district in rank has less than 50,000, which means less the 10% of the number of households in Alberta. This mean the majority of households are accumulated in merely 2 districts in the province.\nThis then led to the last question: whether the housing situation has large difference between the 2 districts (Calgary and Edmonton) and elsewhere in Alberta?\n#suitable housing data vec_suit list_census_vectors(\"CA21\") %% filter(vector == \"v_CA21_4293\") %% child_census_vectors(TRUE, keep_parent = TRUE) accept  get_census(dataset = \"CA21\", regions = regions.list, vectors = vec_suit$vector, level = \"CSD\", labels = \"short\") regions.main  list_census_regions(dataset, use_cache = FALSE) %% filter(level == \"CSD\", name %in% c(\"Calgary\", \"Edmonton\")) %% as_census_region_list ##calgary \u0026 edmonton vs elsewhere rate  accept %% mutate(urban = case_when( GeoUID %in% regions.main$CSD ~ \"Calgary and Edmonton\", TRUE ~ \"Elsewhere\")) ## no identified problems rest.select  rate %% select(contains(\"v_CA21\"), -v_CA21_4293) rate$rest  rowSums(rest.select) rate  rate %% mutate(v_CA21_4293=Households-rest) ##factor order categories  vec_suit %% pull(\"vector\") cat_list  factor(categories, ordered = TRUE) cat_name  vec_suit %% pull(\"label\") cat_name[1]=\"No identified problems\" ##change column names to human readable names(rate)[grepl(\"v_\", names(rate))]  cat_name ##pivot_longer plot_data  rate %% pivot_longer(cols = cat_name[1]:cat_name[8], names_to = \"Categories\", values_to = \"Count\") plot_data$Categories  factor(plot_data$Categories, levels = cat_name, ordered = TRUE) plot_data  plot_data %% group_by(Categories, urban) %% summarise(Count=mean(Count, na.rm = TRUE)) # Make plots wider  #knitr::opts_chunk$set(fig.width=8, fig.height=6) ggplot(plot_data, aes(x=\"\", Count, group=Categories, fill=Categories)) + geom_bar(stat = \"identity\", position=\"fill\", width = 1) + coord_polar(\"y\", start = 0) + facet_wrap(~urban)+ theme_void() + theme(legend.position = \"bottom\", axis.title = element_blank(), strip.text.x = element_text(size=15), legend.text = element_text(size=10), plot.title = element_text(size=20)) + guides(fill=guide_legend(nrow = 4)) + ggtitle(\"Housing problems: \") + scale_fill_brewer(palette = \"Set2\") When assessing housing situation, there are 3 criteria used:\n whether people spend 30% or more income on shelter cost. If people spend more than 30% of their income on housing, it means the cost of housing is too high. whether there are more than one person per room in the dwelling. If there are more than one person per room, it means people have to live in overcrowded dwellings, and it will be considered as “not suitable” housing for living. whether the dwelling needs major repairs.  The above pie chart showed the housing problems in 2 large cities (Calgary and Edmonton) versus elsewhere in Alberta. Overall, there are more percentage of households having identified problems in Calgary and Edmonton. Specifically, there are more people spend more than 30% of their income, and more people living in “not suitable” household. It means in these 2 cities, people are suffer from high cost of housing, they either have to spend more than 30% of their income on housing, or share a room with other to reduce the cost. While in elsewhere in Alberta, the housing situation is slightly better, but there ae more households need major repairs. Which indicates that in elsewhere (other than Calgary and Alberta), there are more percentage of households not in good condition and needs repairs, but people living in couldn’t afford to.\nComments on figures All the data downloading and pre-possessing codes can be found in the first 2 chunks in .rmd file, while figures are shown in separate chunks align with the analysis paragraphs.\nThere are 3 types of figures used in the analysis:\n  The spatial distribution of a given value: I used this showing the distribution of dwelling value and monthly cost people spend on housing. This type of figure could fulfill the purpose showing how the value/cost change in space, and can lead to interesting finding, such as the high value of dwelling cycle around Calgary. When assessing how the price of housing differ in area, this type of figure could be useful. In my figures, I selected the color pallete to make the higher price more significant in bright yellow color, while lower price in deep blue color. This could highlight the area in which having higher price. I also change the scale of legend to dollar signs, which makes more sense for the analized questions.\n  The rank of districts by value: I used geom_point and geom_col to generate the 2 figures about the higher dwelling value and larger number of household. When there are a lot of observations to show, e.g. the dwelling value in districts, geom_point could make the figure more readable; While when there are just 5 observation value to show, i.e. in number of household, geom_col could really make the higher value bar stand out and attract the readers’ attention. In both figures, I reorder the data and make it rank from high to low, which increased the readability. Besides, this type of figure required reader refer to x-axis to find the exact number value, so I used theme_minimal to remain the light grid lines to help indicate the exact value in x-axis.\n  pie chart, which I used to show the percentage of housing problems in different area. ggplot actually doesn’t have a pie chart function, so I modified this from geom_bar by adjusting the function and formulating the data. I selected the color pallete to clearly distinguish the different types of problems. (I don’t know for some reasons the figure can show perfectly in Rmd but can’t show fully in knit html file…)\n  ",
  "wordCount" : "1884",
  "inLanguage": "en",
  "datePublished": "2023-03-15T00:00:00Z",
  "dateModified": "2023-03-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Anqi Ma"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://maanqi4.github.io/posts/cancensus/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Anqi Ma",
    "logo": {
      "@type": "ImageObject",
      "url": "http://maanqi4.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://maanqi4.github.io/" accesskey="h" title="Anqi Ma (Alt + H)">Anqi Ma</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://maanqi4.github.io/home/" title="Resume"
                            aria-label="Resume">Resume</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://maanqi4.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://maanqi4.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://maanqi4.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://maanqi4.github.io/">Home</a>&nbsp;»&nbsp;<a href="http://maanqi4.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Work with Canadian Census data
    </h1>
    <div class="post-meta"><span title='2023-03-15 00:00:00 +0000 UTC'>March 15, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Anqi Ma

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-installation-and-retrieve-the-data-vectors-list-api-key-required">1. Installation and retrieve the data vectors list (API key required)</a></li>
    <li><a href="#2-housing-situation-in-alberta">2. Housing situation in Alberta</a>
      <ul>
        <li><a href="#21-dwelling-value">2.1 Dwelling Value</a></li>
        <li><a href="#22-monthly-cost">2.2 Monthly cost</a></li>
        <li><a href="#23-difference-between-large-cities-and-elsewhere">2.3 Difference between large cities and elsewhere</a></li>
      </ul>
    </li>
    <li><a href="#comments-on-figures">Comments on figures</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>This is a course assignment demo (GG606 Scientific Data Wrangling)</p>
</blockquote>
<blockquote>
<p><a href="https://mountainmath.github.io/cancensus/"><code>cancensus</code></a> is a R package that can assess <a href="https://www12.statcan.gc.ca/census-recensement/2021/dp-pd/prof/index.cfm?Lang=E">Statistics Canada Census data</a> for Census year 1996, 2001, 2006, 2011, 2016 and 2021. The datasets present information from the Census of Population for various levels of geography, including provinces and territories, census metropolitan areas, communities and census tracts.</p>
</blockquote>
<h2 id="1-installation-and-retrieve-the-data-vectors-list-api-key-required">1. Installation and retrieve the data vectors list (API key required)<a hidden class="anchor" aria-hidden="true" href="#1-installation-and-retrieve-the-data-vectors-list-api-key-required">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;cancensus&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cancensus</span><span class="p">)</span>

<span class="c1">#view avaliable Census data</span>
<span class="nf">list_census_datasets</span><span class="p">()</span>
<span class="c1">#view regions and vectors in a given dataset</span>
<span class="nf">list_census_regions</span><span class="p">(</span><span class="s">&#34;CA21&#34;</span><span class="p">)</span>
<span class="nf">list_census_vectors</span><span class="p">(</span><span class="s">&#34;CA21&#34;</span><span class="p">)</span>

<span class="c1">#retrieve the data needed</span>
<span class="c1">#Warning: Cached regions list may be out of date. Set `use_cache = FALSE` to update it.</span>
    <span class="nf">library</span><span class="p">(</span><span class="n">geojsonsf</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">&lt;-</span> <span class="s">&#34;CA21&#34;</span>
    <span class="c1">#set census api</span>
    <span class="nf">set_cancensus_api_key</span><span class="p">(</span><span class="s">&#39;ENTER API KEY&#39;</span><span class="p">)</span>
    <span class="nf">set_cancensus_cache_path</span><span class="p">(</span><span class="nf">here</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">))</span>
    <span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</code></pre></div><pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.4.0      ✔ purrr   1.0.0 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.5.0 
## ✔ readr   2.1.3      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="n">regions.list</span> <span class="o">&lt;-</span> <span class="nf">list_census_regions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">use_cache</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
      <span class="nf">filter</span><span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="s">&#34;PR&#34;</span><span class="p">,</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#34;Alberta&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">as_census_region_list</span>

    <span class="n">vec</span> <span class="o">&lt;-</span> <span class="nf">find_census_vectors</span><span class="p">(</span><span class="s">&#34;housing&#34;</span><span class="p">,</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">query_type</span> <span class="o">=</span> <span class="s">&#34;semantic&#34;</span><span class="p">)</span>
</code></pre></div><h2 id="2-housing-situation-in-alberta">2. Housing situation in Alberta<a hidden class="anchor" aria-hidden="true" href="#2-housing-situation-in-alberta">#</a></h2>
<h3 id="21-dwelling-value">2.1 Dwelling Value<a hidden class="anchor" aria-hidden="true" href="#21-dwelling-value">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="c1"># getting 2021 data</span>
    <span class="c1"># selecting vectors in need</span>

    <span class="c1"># Median Dwelling value</span>
    <span class="n">dwelling.21.cost</span> <span class="o">&lt;-</span> <span class="nf">get_census</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="s">&#34;CA21&#34;</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">regions.list</span><span class="p">,</span>
                              <span class="n">vectors</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;median.dwelling&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4311&#34;</span><span class="p">),</span> 
                              <span class="n">level</span> <span class="o">=</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;short&#39;</span><span class="p">,</span> <span class="n">geo_format</span> <span class="o">=</span> <span class="s">&#39;sf&#39;</span><span class="p">)</span>

    <span class="n">dwelling.21.value</span> <span class="o">&lt;-</span> <span class="nf">get_census</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="s">&#34;CA21&#34;</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">regions.list</span><span class="p">,</span>
                              <span class="n">vectors</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;median.dwelling&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4311&#34;</span><span class="p">),</span> 
                              <span class="n">level</span> <span class="o">=</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;short&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
      <span class="nf">slice_max</span><span class="p">(</span><span class="n">median.dwelling</span><span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="m">.05</span><span class="p">)</span> 

    <span class="nf">ggplot</span><span class="p">(</span><span class="n">dwelling.21.cost</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">median.dwelling</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
      <span class="nf">theme</span><span class="p">(</span><span class="n">panel.grid</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">axis.text</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">axis.ticks</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">coord_sf</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span> <span class="o">+</span>
      <span class="nf">scale_fill_viridis_c</span><span class="p">(</span><span class="s">&#34;Median Dwellings Value&#34;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="n">dollar</span><span class="p">)</span>
</code></pre></div><p><img loading="lazy" src="/images/cancensus/unnamed-chunk-3-1.png" alt=""  />
</p>
<p>By looking at general housing situation, I first started with the price
of dwellings. The first figure showed the distribution of median
dwelling value in Alberta. In a large number of district, the value of
dwellings are around $500,000 and above. Roughly, the price of dwellings
is more expensive in the southern Alberta compared with the North, which
might related to what kind of climate people want to live in. There is a
special pattern around the district of Calgary, where in the center of
Calgary, the price of dwellings is far less than its surrounding area.
The similar, but less obvious pattern could be found around Edmonton.
The reason may relate to people prefer to live in suburban area compared
with living in downtown, but the gap of dwellings value around Calgary
is astonishing. Besides, the surrounding cycle outside Alberta is the
most expensive area in terms of dwellings value in the province. The
next figure will look into it in more detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="nf">options</span><span class="p">(</span><span class="n">scipen</span> <span class="o">=</span> <span class="m">999</span><span class="p">)</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="n">dwelling.21.value</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">median.dwelling</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">`Region Name`</span><span class="p">,</span> <span class="n">median.dwelling</span><span class="p">)))</span> <span class="o">+</span>
      <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span> <span class="o">+</span> 
      <span class="nf">xlab</span><span class="p">(</span><span class="s">&#34;Median Dwellings Value&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;Districts with Top 5% Median Dwellings Value in Alberta&#34;</span><span class="p">)</span>
</code></pre></div><p><img loading="lazy" src="/images/cancensus/unnamed-chunk-4-1.png" alt=""  />
</p>
<p>The second figure looked into dwelling value in more detail: showing the
districts with top 5% median dwelling value. 25 out of 423 districts in
Alberta have been selected with higher median dwelling value, and
particularly, all district with median dwelling value higher than
$500,000 have been selected. Apparently, the district around Calgary
have all been included, and also the districts to the west of Calgary.
By Google-search these district names, I realized these districts
located in a good place for relax and vacation. There are often beside
the lake (e.g. Birchcliff, Jarvis Bay) or near natural park (e.g. Banff,
Jasper). The abnormal increase of the dwelling value may be related to
its good location and nature environment.</p>
<h3 id="22-monthly-cost">2.2 Monthly cost<a hidden class="anchor" aria-hidden="true" href="#22-monthly-cost">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="c1"># Median Monthly shelter cost</span>
    <span class="n">mon.cost.21</span> <span class="o">&lt;-</span> <span class="nf">get_census</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="s">&#34;CA21&#34;</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">regions.list</span><span class="p">,</span>
                              <span class="n">vectors</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;median.cost.rent&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4317&#34;</span><span class="p">,</span> 
                                          <span class="s">&#34;median.cost.own&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4309&#34;</span><span class="p">),</span> 
                              <span class="n">level</span> <span class="o">=</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> 
                              <span class="n">geo_format</span> <span class="o">=</span> <span class="s">&#39;sf&#39;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;short&#39;</span><span class="p">)</span>

    <span class="n">mon.cost.21</span> <span class="o">&lt;-</span> <span class="n">mon.cost.21</span> <span class="o">%&gt;%</span> <span class="nf">pivot_longer</span><span class="p">(</span><span class="n">cols</span> <span class="o">=</span> <span class="nf">starts_with</span><span class="p">(</span><span class="s">&#34;median.cost&#34;</span><span class="p">),</span> 
                                 <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;status&#34;</span><span class="p">,</span>
                                 <span class="n">names_prefix</span> <span class="o">=</span> <span class="s">&#34;median.cost.&#34;</span><span class="p">,</span>
                                 <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;month.cost&#34;</span><span class="p">)</span>
    <span class="n">mon.cost.21</span><span class="o">$</span><span class="n">status</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">mon.cost.21</span><span class="o">$</span><span class="n">status</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;own&#34;</span><span class="p">,</span><span class="s">&#34;rent&#34;</span><span class="p">),</span>
                          <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Owner Households&#34;</span><span class="p">,</span> <span class="s">&#34;Renter Households&#34;</span><span class="p">))</span>

    <span class="nf">ggplot</span><span class="p">(</span><span class="n">mon.cost.21</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">month.cost</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
      <span class="nf">theme</span><span class="p">(</span><span class="n">panel.grid</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">axis.text</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">axis.ticks</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">coord_sf</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span> <span class="o">+</span>
      <span class="nf">scale_fill_viridis_c</span><span class="p">(</span><span class="s">&#34;Median Monthly cost&#34;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="n">dollar</span><span class="p">)</span> <span class="o">+</span>
      <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">status</span><span class="p">)</span>
</code></pre></div><p><img loading="lazy" src="/images/cancensus/unnamed-chunk-5-1.png" alt=""  />
</p>
<p>The next question I had about the housing is whether the cost of housing
people spend monthly share the same distribution as the dwelling price?</p>
<p>The above figure showed the median monthly cost people spend per
household. The monthly cost, in general, share the same characteristic
as the dwelling price: where the dwelling value is low, the monthly cost
people spend on housing is also tend to be low.</p>
<p>There are 2 interesting differences: first the cycle of higher price
around Calgary is disappeared. So people who live in high value
dwellings actually don’t spend significantly more monthly. It might
because those high value dwellings are owned, not rented, and the cost
for owner maintaining is not significantly higher. We can also notice
this in the right sub-figure in figure-3, where area which has high
value of dwellings actually have average or even lower monthly cost for
renter households.</p>
<p>The second interesting difference is between the owner household and
renter household. The monthly cost distribution tend to be the same,
however, in the northeastern area, the owner households have a abnormal
high cost monthly. By Google-search, the Northeastern area is
agricultural area, where the owner might spend more to maintain their
farm house, which not only serve as living.</p>
<h3 id="23-difference-between-large-cities-and-elsewhere">2.3 Difference between large cities and elsewhere<a hidden class="anchor" aria-hidden="true" href="#23-difference-between-large-cities-and-elsewhere">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="c1"># Number of Household of Renter and Owner</span>
    <span class="n">household</span> <span class="o">&lt;-</span> <span class="nf">get_census</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="s">&#34;CA21&#34;</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">regions.list</span><span class="p">,</span>
                              <span class="n">vectors</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;status.Renter&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4239&#34;</span><span class="p">,</span> 
                                          <span class="s">&#34;status.Owner&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4238&#34;</span><span class="p">,</span>
                                          <span class="s">&#34;total.house&#34;</span><span class="o">=</span><span class="s">&#34;v_CA21_4237&#34;</span><span class="p">),</span> 
                              <span class="n">level</span> <span class="o">=</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> 
                              <span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;short&#39;</span><span class="p">)</span>

    <span class="n">household</span> <span class="o">&lt;-</span> <span class="n">household</span> <span class="o">%&gt;%</span> <span class="nf">slice_max</span><span class="p">(</span><span class="n">total.house</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="m">5</span><span class="p">)</span> 

    <span class="nf">ggplot</span><span class="p">(</span><span class="n">household</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">total.house</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">`Region Name`</span><span class="p">,</span> <span class="n">total.house</span><span class="p">)))</span> <span class="o">+</span>
      <span class="nf">geom_col</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&#34;cornflowerblue&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span> <span class="o">+</span> 
      <span class="nf">xlab</span><span class="p">(</span><span class="s">&#34;Number of Households&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;Districts with Top 5 Number of Household in Alberta&#34;</span><span class="p">)</span> 
</code></pre></div><p><img loading="lazy" src="/images/cancensus/unnamed-chunk-6-1.png" alt=""  />
</p>
<p>While I looking at the household distribution, I realized the households
are distributed very unevenly within Alberta. The above figure showed
the districts with top 5 number of household in Alberta. As shown in the
figure, the number of household in Calgary and Edmonton is extremely
larger than the rest of the province. Calgary has around 500,000
households, with about 400,000 in Edmonton, while the third district in
rank has less than 50,000, which means less the 10% of the number of
households in Alberta. This mean the majority of households are
accumulated in merely 2 districts in the province.</p>
<p>This then led to the last question: whether the housing situation has
large difference between the 2 districts (Calgary and Edmonton) and
elsewhere in Alberta?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r">    <span class="c1">#suitable housing data</span>
    <span class="n">vec_suit</span><span class="o">&lt;-</span> <span class="nf">list_census_vectors</span><span class="p">(</span><span class="s">&#34;CA21&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">vector</span> <span class="o">==</span> <span class="s">&#34;v_CA21_4293&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
      <span class="nf">child_census_vectors</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">keep_parent</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
    <span class="n">accept</span> <span class="o">&lt;-</span> <span class="nf">get_census</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="s">&#34;CA21&#34;</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">regions.list</span><span class="p">,</span>
                         <span class="n">vectors</span> <span class="o">=</span> <span class="n">vec_suit</span><span class="o">$</span><span class="n">vector</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> 
                         <span class="n">labels</span> <span class="o">=</span> <span class="s">&#34;short&#34;</span><span class="p">)</span>

    <span class="n">regions.main</span> <span class="o">&lt;-</span> <span class="nf">list_census_regions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">use_cache</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
      <span class="nf">filter</span><span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="s">&#34;CSD&#34;</span><span class="p">,</span> <span class="n">name</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Calgary&#34;</span><span class="p">,</span> <span class="s">&#34;Edmonton&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span> 
      <span class="n">as_census_region_list</span>

    <span class="c1">##calgary &amp; edmonton vs elsewhere</span>
    <span class="n">rate</span> <span class="o">&lt;-</span> <span class="n">accept</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">urban</span> <span class="o">=</span> 
                                <span class="nf">case_when</span><span class="p">(</span>
                                  <span class="n">GeoUID</span> <span class="o">%in%</span> <span class="n">regions.main</span><span class="o">$</span><span class="n">CSD</span> <span class="o">~</span> <span class="s">&#34;Calgary and Edmonton&#34;</span><span class="p">,</span>
                                  <span class="kc">TRUE</span> <span class="o">~</span> <span class="s">&#34;Elsewhere&#34;</span><span class="p">))</span> 
    <span class="c1">## no identified problems</span>
    <span class="n">rest.select</span> <span class="o">&lt;-</span> <span class="n">rate</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">contains</span><span class="p">(</span><span class="s">&#34;v_CA21&#34;</span><span class="p">),</span> <span class="o">-</span><span class="n">v_CA21_4293</span><span class="p">)</span>
    <span class="n">rate</span><span class="o">$</span><span class="n">rest</span> <span class="o">&lt;-</span> <span class="nf">rowSums</span><span class="p">(</span><span class="n">rest.select</span><span class="p">)</span>
    <span class="n">rate</span> <span class="o">&lt;-</span> <span class="n">rate</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">v_CA21_4293</span><span class="o">=</span><span class="n">Households</span><span class="o">-</span><span class="n">rest</span><span class="p">)</span>

    <span class="c1">##factor order</span>
    <span class="n">categories</span> <span class="o">&lt;-</span> <span class="n">vec_suit</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="s">&#34;vector&#34;</span><span class="p">)</span>
    <span class="n">cat_list</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">ordered</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
    <span class="n">cat_name</span> <span class="o">&lt;-</span> <span class="n">vec_suit</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="s">&#34;label&#34;</span><span class="p">)</span>
    <span class="n">cat_name[1]</span><span class="o">=</span><span class="s">&#34;No identified problems&#34;</span>

    <span class="c1">##change column names to human readable</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span><span class="nf">[grepl</span><span class="p">(</span><span class="s">&#34;v_&#34;</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">rate</span><span class="p">))</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">cat_name</span>

    <span class="c1">##pivot_longer</span>
    <span class="n">plot_data</span> <span class="o">&lt;-</span> <span class="n">rate</span> <span class="o">%&gt;%</span> <span class="nf">pivot_longer</span><span class="p">(</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cat_name[1]</span><span class="o">:</span><span class="n">cat_name[8]</span><span class="p">,</span>
                                       <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;Categories&#34;</span><span class="p">,</span>
                                       <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;Count&#34;</span><span class="p">)</span>
    <span class="n">plot_data</span><span class="o">$</span><span class="n">Categories</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">plot_data</span><span class="o">$</span><span class="n">Categories</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">cat_name</span><span class="p">,</span> 
                                   <span class="n">ordered</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> 
    <span class="n">plot_data</span> <span class="o">&lt;-</span> <span class="n">plot_data</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">Categories</span><span class="p">,</span> <span class="n">urban</span><span class="p">)</span> <span class="o">%&gt;%</span> 
      <span class="nf">summarise</span><span class="p">(</span><span class="n">Count</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>

    <span class="c1"># Make plots wider </span>
    <span class="c1">#knitr::opts_chunk$set(fig.width=8, fig.height=6)</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="n">plot_data</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">Categories</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Categories</span><span class="p">))</span> <span class="o">+</span>
      <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">&#34;identity&#34;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&#34;fill&#34;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">coord_polar</span><span class="p">(</span><span class="s">&#34;y&#34;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
      <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">urban</span><span class="p">)</span><span class="o">+</span> <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
      <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">,</span> <span class="n">axis.title</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
            <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">15</span><span class="p">),</span> 
            <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">),</span>
            <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">4</span><span class="p">))</span> <span class="o">+</span> 
      <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;Housing problems: &#34;</span><span class="p">)</span> <span class="o">+</span>
      <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Set2&#34;</span><span class="p">)</span>
</code></pre></div><p><img loading="lazy" src="/images/cancensus/unnamed-chunk-7-1.png" alt=""  />
</p>
<p>When assessing housing situation, there are 3 criteria used:</p>
<ol>
<li>whether people spend 30% or more income on shelter cost. If people
spend more than 30% of their income on housing, it means the cost of
housing is too high.</li>
<li>whether there are more than one person per room in the dwelling. If
there are more than one person per room, it means people have to
live in overcrowded dwellings, and it will be considered as “not
suitable” housing for living.</li>
<li>whether the dwelling needs major repairs.</li>
</ol>
<p>The above pie chart showed the housing problems in 2 large cities
(Calgary and Edmonton) versus elsewhere in Alberta. Overall, there are
more percentage of households having identified problems in Calgary and
Edmonton. Specifically, there are more people spend more than 30% of
their income, and more people living in “not suitable” household. It
means in these 2 cities, people are suffer from high cost of housing,
they either have to spend more than 30% of their income on housing, or
share a room with other to reduce the cost. While in elsewhere in
Alberta, the housing situation is slightly better, but there ae more
households need major repairs. Which indicates that in elsewhere (other
than Calgary and Alberta), there are more percentage of households not
in good condition and needs repairs, but people living in couldn’t
afford to.</p>
<h2 id="comments-on-figures">Comments on figures<a hidden class="anchor" aria-hidden="true" href="#comments-on-figures">#</a></h2>
<p>All the data downloading and pre-possessing codes can be found in the
first 2 chunks in .rmd file, while figures are shown in separate chunks
align with the analysis paragraphs.</p>
<p>There are 3 types of figures used in the analysis:</p>
<ol>
<li>
<p>The spatial distribution of a given value: I used this showing the
distribution of dwelling value and monthly cost people spend on
housing. This type of figure could fulfill the purpose showing how
the value/cost change in space, and can lead to interesting finding,
such as the high value of dwelling cycle around Calgary. When
assessing how the price of housing differ in area, this type of
figure could be useful. In my figures, I selected the color pallete
to make the higher price more significant in bright yellow color,
while lower price in deep blue color. This could highlight the area
in which having higher price. I also change the scale of legend to
dollar signs, which makes more sense for the analized questions.</p>
</li>
<li>
<p>The rank of districts by value: I used <code>geom_point</code> and <code>geom_col</code>
to generate the 2 figures about the higher dwelling value and larger
number of household. When there are a lot of observations to show,
e.g. the dwelling value in districts, <code>geom_point</code> could make the
figure more readable; While when there are just 5 observation value
to show, i.e. in number of household, <code>geom_col</code> could really make
the higher value bar stand out and attract the readers’ attention.
In both figures, I reorder the data and make it rank from high to
low, which increased the readability. Besides, this type of figure
required reader refer to x-axis to find the exact number value, so I
used <code>theme_minimal</code> to remain the light grid lines to help indicate
the exact value in x-axis.</p>
</li>
<li>
<p>pie chart, which I used to show the percentage of housing problems
in different area. <code>ggplot</code> actually doesn’t have a pie chart
function, so I modified this from <code>geom_bar</code> by adjusting the
function and formulating the data. I selected the color pallete to
clearly distinguish the different types of problems. (I don’t know
for some reasons the figure can show perfectly in Rmd but can’t show
fully in knit html file…)</p>
</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://maanqi4.github.io/tags/rstudio/">RStudio</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://maanqi4.github.io/posts/climatebench/">
    <span class="title">« Prev</span>
    <br>
    <span>[Demo] A Benchmark for Data-Driven Climate Projections</span>
  </a>
  <a class="next" href="http://maanqi4.github.io/posts/earthquakes/">
    <span class="title">Next »</span>
    <br>
    <span>Earthquakes data analysis demo</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="http://maanqi4.github.io/">Anqi Ma</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
